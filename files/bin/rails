#!/usr/bin/env bash

cmd=''
bin_dir=$(gem env gemhome)/bin

[[ -f `pwd`/Gemfile ]] && has_gemfile=true
[[ -f `pwd`/Procfile ]] && has_procfile=true
[[ -f `pwd`/bin/rails ]] && has_local_bin=true

if [[ "$has_procfile" = true ]]; then
  cmd="foreman run"
fi

if [[ "$has_gemfile" = true ]]; then
  cmd="$cmd bundle exec"
fi

if [[ "$has_local_bin" = true ]]; then
  cmd="$cmd ./bin/rails"
else
  cmd="$cmd $bin_dir/rails"
fi

$cmd $@
